name: Backend Feature CI - Quick Check

on:
  push:
    branches:
      - feat/**
      - hotfix/**

jobs:
  quick-check:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2

      # 1주차 생략
      # formatting
      #      - name: Run Spotless Check
      #        run: ./gradlew spotlessCheck

      # 1주차 생략
      # convention
      #      - name: Run Checkstyle
      #        run: ./gradlew checkstyleMain checkstyleTest

      # 빌드
      - name: Build with Gradle
        run: ./gradlew build -x test

      # Feature 브랜치에서는 테스트와 SonarCloud 생략

      # CI 결과 알림 (실패 시에만)
      # 테스트 실패 디스코드 알림
      - name: Notify Test Failure
        if: always()
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d '{
                 "embeds": [{
                   "title": "백엔드 테스트 실패 ❌",
                   "color": 16711680,
                   "fields": [
                     {"name": "결과", "value": "실패", "inline": true},
                     {"name": "브랜치", "value": "${{ github.ref_name }}", "inline": true},
                     {"name": "작성자", "value": "${{ github.actor }}", "inline": true},
                     {"name": "커밋", "value": "`${{ github.sha }}`", "inline": false},
                     {"name": "이벤트", "value": "PR 테스트", "inline": true}
                   ]
                 }]
               }' \
               ${{ secrets.DISCORD_WEBHOOK_URL }}