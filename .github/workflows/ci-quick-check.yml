name: Backend Feature CI - Quick Check

on:
  push:
    branches:
      - feat/**
      - hotfix/**

jobs:
  quick-check:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2

      # 1주차 생략
      # formatting
      #      - name: Run Spotless Check
      #        run: ./gradlew spotlessCheck

      # 1주차 생략
      # convention
      #      - name: Run Checkstyle
      #        run: ./gradlew checkstyleMain checkstyleTest

      # 빌드
      - name: Build with Gradle
        run: ./gradlew build -x test

      # Feature 브랜치에서는 테스트와 SonarCloud 생략

      # CI 결과 알림 (실패 시에만)
      - name: Notify CI result to Discord
        if: failure()
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "Backend Feature CI ${{ job.status }}"
          description: |
            **Result:** ${{ job.status }}
            **Branch:** ${{ github.ref_name }}
            **Author:** ${{ github.actor }}
            **Commit:** ${{ github.sha }}
          color: ${{ job.status == 'success' && '0x00ff00' || '0xff0000' }}