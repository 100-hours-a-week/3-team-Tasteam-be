name: Backend Feature CI - Quick Check

on:
  push:
    branches:
      - feat/**
      - hotfix/**

jobs:
  quick-check:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2

      # 1ì£¼ì°¨ ìƒëµ
      # formatting
      #      - name: Run Spotless Check
      #        run: ./gradlew spotlessCheck

      # 1ì£¼ì°¨ ìƒëµ
      # convention
      #      - name: Run Checkstyle
      #        run: ./gradlew checkstyleMain checkstyleTest

      # ë¹Œë“œ
      - name: Build with Gradle
        run: ./gradlew build -x test

      # Feature ë¸Œëœì¹˜ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ì™€ SonarCloud ìƒëµ

      # CI ê²°ê³¼ ì•Œë¦¼ (ì‹¤íŒ¨ ì‹œì—ë§Œ)
      # í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼
      - name: Notify Test Failure
        if: failure()
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d '{
                 "embeds": [{
                   "title": "ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ğŸ’”",
                   "color": 16711680,
                   "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                   "fields": [
                     {"name": "ê²°ê³¼", "value": "ì‹¤íŒ¨", "inline": true},
                     {"name": "ë¸Œëœì¹˜", "value": "${{ github.ref_name }}", "inline": true},
                     {"name": "ì‘ì„±ì", "value": "${{ github.actor }}", "inline": true},
                     {"name": "ì»¤ë°‹", "value": "`${{ github.sha }}`", "inline": false},
                     {"name": "ì›Œí¬í”Œë¡œìš°", "value": "[ì‹¤í–‰ ë¡œê·¸ ë³´ê¸°](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})", "inline": false}
                   ]
                 }]
               }' \
               ${{ secrets.DISCORD_WEBHOOK_URL }}
