# 운영/성능 개선 과제 (비쿼리)

이 문서는 쿼리 외적으로 개선 가능한 운영/성능 과제를 정리한 것입니다.

## 1. 캐시 전략 수립

### 대상 구분
- 빈번 조회: 메인/홈 목록, 상세 조회(읽기 집중), 인기 순위
- 설정성 데이터: 코드 테이블, 정책/약관, 카테고리/태그
- 파생/집계 데이터: 리뷰 수, 즐겨찾기 수, 인기 지표

### 정책 초안
- 캐시 키 표준: `서비스:도메인:리소스:버전:파라미터`
- TTL 가이드
  - 빈번 조회: 30s~5m
  - 인기 목록: 1m~10m
  - 설정성 데이터: 1h~24h
- 무효화 방식
  - 이벤트 기반: 변경 시 해당 키 삭제/갱신
  - TTL 기반: 변경 빈도가 낮을 때

### 기술 선택
- 로컬 캐시: 단일 인스턴스 테스트/개발
- 분산 캐시(예: Redis): 운영 환경, 다중 인스턴스

### 적용 순서
1. 읽기 부하가 큰 엔드포인트 선정
2. 캐시 키/TTL 정의
3. 캐시 적중률/미스율 모니터링 추가
4. 변경 이벤트 연동 (필요 시)

## 2. 배치/스케줄러 정리

### 대상 구분
- 주기성 작업: 통계 집계, 인기 지표 업데이트
- 정합성 보정: 소프트 삭제 정리, 누락 데이터 보정
- 데이터 만료: 토큰/임시 데이터 삭제

### 정책 초안
- 스케줄 기준: 오프피크 시간대 실행
- 장애 시 재시도 정책 정의
- 중복 실행 방지(락/리더 선출)

### 체크리스트
- 작업별 실행 주기 및 소요 시간 기록
- 실패 시 알림/롤백 정책 정의
- 실행 이력 저장 및 모니터링 지표 노출

## 3. 외부 API 호출 안정성

### 기본 기준
- 타임아웃: 연결/읽기/전체 타임아웃 분리
- 재시도: 멱등 요청만 대상, 지수 백오프 적용
- 회로차단기: 실패율 기준 차단/복구

### 권장 파라미터 예시
- connect timeout: 1s~3s
- read timeout: 2s~5s
- retry: 2~3회 (백오프 200ms~1s)
- circuit breaker: 실패율 50% 이상, 30s 차단

### 적용 순서
1. 외부 API 목록화
2. 중요도/장애 영향도 분류
3. 공통 클라이언트 설정 적용
4. 메트릭/알림 연동

## 다음 단계 제안
- 캐시 대상 엔드포인트 우선순위 선정
- 배치/스케줄러 목록 현황 조사
- 외부 API 호출 경로 목록화 및 공통 설정 적용
